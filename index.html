<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Maribel y Cristian ‚Äî √Årbol de Corazones (PWA)</title>

<!-- PWA: Manifest + theme -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ffd7e8">

<!-- iOS (opcional) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
  :root{
    --card-bg:#fff6f9;
    --card-radius:28px;
    --accent:#ff6f91;
    --ink:#3a2b2e;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
    color:var(--ink);
    background:
      radial-gradient(1200px 600px at 20% -10%, rgba(255,180,200,.35), transparent 60%),
      radial-gradient(1000px 700px at 120% 10%, rgba(255,210,230,.45), transparent 60%),
      linear-gradient(180deg, #fff0f5 0%, #ffe3ee 40%, #ffd7e8 100%);
    overflow-x:hidden;
  }

  .bg-hearts{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0; }
  .bg-heart{
    position:absolute; color:#ffb3c1; opacity:.18; font-size:clamp(16px, 4vw, 36px);
    animation: floatBg linear infinite; filter: blur(.2px);
  }
  @keyframes floatBg{
    from{ transform:translateY(110vh) rotate(0deg) }
    to  { transform:translateY(-20vh) rotate(360deg) }
  }

  .wrap{ position:relative; z-index:1; max-width:860px; margin:26px auto; padding:16px; }
  .card{
    background:var(--card-bg);
    border-radius:var(--card-radius);
    box-shadow:0 12px 40px rgba(0,0,0,.12);
    padding:24px 16px 28px;
    border:1px solid #ffe2ec;
  }

  .title{ text-align:center; font-weight:800; letter-spacing:.3px; margin:6px 8px 4px; font-size:clamp(20px, 4.6vw, 28px); color:#a14d66; }
  .subtitle{ text-align:center; margin:0 0 16px; color:#b36a80; font-weight:600; }

  .canvas-wrap{ position:relative; width:100%; aspect-ratio: 16/10; border-radius:18px; overflow:hidden; background: #ffe9f0; border:1px solid #ffd6e3; }

  .lead{margin:14px 10px 4px; color:#7d5a63}
  .timer{ margin:0 10px 10px; font-size:clamp(18px, 4.5vw, 26px); font-weight:800; color:#5b434a; letter-spacing:.2px; }
  .ground{ height:2px; background:#9a6f6f; opacity:.35; margin:10px 6px 0; border-radius:2px; }

  .cta{ display:flex; justify-content:center; margin-top:18px; }
  .love-btn{
    position:relative; display:inline-flex; align-items:center; gap:.6rem;
    padding:.95rem 1.25rem; border-radius:999px; border:none; cursor:pointer;
    font-weight:900; letter-spacing:.4px; color:white;
    background: radial-gradient(120% 180% at 30% 20%, #ff9ab2, #ff6f91 50%, #ff477e 100%);
    box-shadow: 0 10px 22px rgba(255,111,145,.35), inset 0 0 18px rgba(255,255,255,.18);
    transform:translateZ(0); animation:pulse 2.2s ease-in-out infinite; user-select:none;
  }
  .love-btn:active{ transform:scale(.98) }
  .love-btn .heart-ico{ filter: drop-shadow(0 2px 2px rgba(0,0,0,.15)); }
  @keyframes pulse{
    0%,100%{ box-shadow:0 10px 22px rgba(255,111,145,.35), 0 0 0 0 rgba(255,111,145,.35) }
    50%{ box-shadow:0 10px 22px rgba(255,111,145,.35), 0 0 0 16px rgba(255,111,145,0) }
  }
  .burst{ position:absolute; inset:0; pointer-events:none; overflow:visible; }
  .burst span{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    font-size:14px; color:#ff8fab; will-change:transform,opacity; animation:pop 900ms ease-out forwards;
    text-shadow:0 1px 0 rgba(255,255,255,.6);
  }
  @keyframes pop{
    0%{ opacity:1; transform:translate(-50%,-50%) scale(.4) }
    80%{ opacity:1 }
    100%{ opacity:0; transform:translate(var(--dx), var(--dy)) rotate(var(--rot)) scale(0.9) }
  }

  /* Bot√≥n ‚ÄúInstalar app‚Äù flotante */
  .install-btn{
    position: fixed; right: 14px; bottom: 14px; z-index: 10;
    padding:.7rem 1rem; border-radius:999px; border:none; cursor:pointer;
    background:#ffffffdd; color:#a14d66; font-weight:800; box-shadow:0 6px 18px rgba(0,0,0,.15);
    display:none;
  }
  .install-btn.show{ display:inline-block; }

  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>
</head>
<body>

<!-- Fondo: corazones flotando -->
<div class="bg-hearts" aria-hidden="true" id="bg"></div>

<div class="wrap">
  <div class="card" role="group" aria-label="Tarjeta de San Valent√≠n">
    <h2 class="title">Maribel ‚ù§Ô∏è Cristian</h2>
    <p class="subtitle">Para el amor de mi vida</p>

    <!-- Lienzo del √°rbol animado -->
    <div class="canvas-wrap">
      <canvas id="heartTreeCanvas"></canvas>
    </div>

    <p class="lead">Mi amor por ti comenz√≥ hace‚Ä¶</p>
    <p class="timer"><span id="d"></span> d√≠as <span id="h"></span> horas <span id="m"></span> minutos <span id="s"></span> segundos</p>

    <div class="ground" aria-hidden="true"></div>

    <!-- Bot√≥n Te amo + estallido -->
    <div class="cta">
      <button class="love-btn" id="loveBtn" aria-live="polite" aria-label="Te amo">
        <span class="heart-ico" aria-hidden="true">üíó</span>
        Te amo
        <span class="heart-ico" aria-hidden="true">üíó</span>
        <span class="burst" aria-hidden="true" id="burst"></span>
      </button>
    </div>

    <!-- Audio: coloca tu archivo local con este nombre -->
    <audio id="bgMusic" preload="auto">
      <source src="Married-Life-Up.mp3" type="audio/mpeg">
      Tu navegador no soporta audio HTML5.
    </audio>
  </div>
</div>

<!-- Bot√≥n flotante para instalar PWA -->
<button id="pwaInstall" class="install-btn" aria-label="Instalar app">‚ûï Instalar app</button>

<script>
/* ========= Ajustes personalizados ========= */
const FECHA_INICIO = "2025-11-20"; // 20/11/2025
const HEART_COLORS = ["#FFB3C1","#FFD6E0","#FFC2D1","#FFAEC0","#F8BBD0","#F4A7B9","#FFD1DC","#FFCCD5","#FDD7E4","#FAD1D7"];
const LEAF_COUNT = 420, LEAF_FALL_PROB = 0.0025, WIND_STRENGTH = 0.7, BG_HEARTS = 22;

/* ========= Fondo con corazones ========= */
(function bgHearts(){
  const bg = document.getElementById('bg');
  const durBase = 20;
  for(let i=0;i<BG_HEARTS;i++){
    const span = document.createElement('span');
    span.className = 'bg-heart';
    span.textContent = 'üíó';
    span.style.left = (Math.random()*100)+'%';
    span.style.bottom = (-20 + Math.random()*40) + 'vh';
    span.style.fontSize = (18 + Math.random()*42)+'px';
    span.style.opacity = (0.10 + Math.random()*0.18);
    span.style.animationDuration = (durBase + Math.random()*14)+'s';
    span.style.animationDelay = (-Math.random()*durBase)+'s';
    bg.appendChild(span);
  }
})();

/* ========= √Årbol en canvas ========= */
const canvas = document.getElementById('heartTreeCanvas');
const ctx = canvas.getContext('2d', { alpha: true });
let W, H, DPR;

function fitCanvas(){
  DPR = Math.min(window.devicePixelRatio || 1, 2);
  const wrap = canvas.parentElement.getBoundingClientRect();
  W = wrap.width; H = wrap.height;
  canvas.width = Math.floor(W * DPR); canvas.height = Math.floor(H * DPR);
  canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
fitCanvas(); addEventListener('resize', fitCanvas);

function trunkPath(){
  const baseY = H*0.88;
  ctx.save(); ctx.beginPath();
  ctx.moveTo(W*0.62, baseY);
  ctx.bezierCurveTo(W*0.60, H*0.72, W*0.58, H*0.60, W*0.59, H*0.48);
  ctx.bezierCurveTo(W*0.60, H*0.40, W*0.57, H*0.30, W*0.56, H*0.22);
  ctx.lineTo(W*0.53, H*0.22);
  ctx.bezierCurveTo(W*0.52, H*0.32, W*0.51, H*0.44, W*0.52, H*0.52);
  ctx.bezierCurveTo(W*0.52, H*0.64, W*0.50, H*0.74, W*0.48, H*0.88);
  ctx.closePath();
  const grad = ctx.createLinearGradient(0, H*0.2, 0, H*0.9);
  grad.addColorStop(0, '#b18063'); grad.addColorStop(1, '#8f5f47');
  ctx.fillStyle = grad; ctx.fill(); ctx.lineWidth = 1.5; ctx.strokeStyle = 'rgba(0,0,0,.10)'; ctx.stroke(); ctx.restore();
}
function drawHeart(x, y, s, r, color){
  ctx.save(); ctx.translate(x,y); ctx.rotate(r); ctx.scale(s,s);
  ctx.beginPath();
  ctx.moveTo(0,-10);
  ctx.bezierCurveTo(12,-24, 34,-14, 0, 12);
  ctx.bezierCurveTo(-34,-14, -12,-24, 0,-10);
  ctx.closePath();
  const g = ctx.createRadialGradient(-4,-8,1, 0,0,26);
  g.addColorStop(0,'rgba(255,255,255,.95)');
  g.addColorStop(0.2,'rgba(255,255,255,.25)');
  g.addColorStop(0.25,color);
  g.addColorStop(1,color);
  ctx.fillStyle = g; ctx.fill(); ctx.restore();
}
const leaves=[], falling=[];
function seedLeaves(){
  leaves.length=0;
  const cx=W*0.48, cy=H*0.32, rx=W*0.28, ry=H*0.22;
  for(let i=0;i<LEAF_COUNT;i++){
    let x,y,tries=0;
    do{ x=(Math.random()*2-1)*rx; y=(Math.random()*2-1)*ry; tries++; if(tries>10) break; }
    while((x*x)/(rx*rx) + (y*y)/(ry*ry) > 1);
    const baseX=cx+x+(Math.random()-0.5)*6;
    const baseY=cy+y+(Math.random()-0.5)*6;
    leaves.push({
      baseX, baseY, size:0.25+Math.random()*0.52, rot0:Math.random()*Math.PI,
      color: HEART_COLORS[(Math.random()*HEART_COLORS.length)|0],
      swayA:5+Math.random()*10, swayW:.6+Math.random()*1.1, rotA:0.18+Math.random()*0.55, t0:Math.random()*1000
    });
  }
}
seedLeaves();
let tStart=performance.now();
function tick(now){
  const t=(now-tStart)/1000;
  ctx.clearRect(0,0,W,H);
  const bgGrad = ctx.createLinearGradient(0,0,0,H);
  bgGrad.addColorStop(0, '#fff2f7'); bgGrad.addColorStop(1, '#ffe6ef');
  ctx.fillStyle = bgGrad; ctx.fillRect(0,0,W,H);
  trunkPath();
  for(const leaf of leaves){
    const wind=Math.sin((t+leaf.t0)*leaf.swayW)*leaf.swayA*WIND_STRENGTH;
    const x=leaf.baseX+wind;
    const y=leaf.baseY+Math.sin((t+leaf.t0)*leaf.swayW*0.9)*2;
    const r=leaf.rot0+Math.sin((t+leaf.t0)*leaf.swayW)*leaf.rotA;
    drawHeart(x,y,leaf.size,r,leaf.color);
    if(Math.random()<LEAF_FALL_PROB){
      falling.push({x,y,vx:(Math.random()*0.6+0.2)*(Math.random()<.5?-1:1), vy:-(Math.random()*0.3),
                    rot:r, vr:(Math.random()-.5)*0.06, size:leaf.size, color:leaf.color, life:0});
    }
  }
  for(let i=falling.length-1;i>=0;i--){
    const f=falling[i]; f.life+=1/60;
    const gust=Math.sin((t+f.life*2)*1.4)*0.16*WIND_STRENGTH;
    f.vx+=gust*0.002; f.vy+=0.055; f.x+=f.vx*2; f.y+=f.vy*2; f.rot+=f.vr;
    drawHeart(f.x,f.y,f.size,f.rot,f.color);
    if(f.y>H+40) falling.splice(i,1);
  }
  requestAnimationFrame(tick);
}
requestAnimationFrame(tick);
addEventListener('resize', ()=>{ fitCanvas(); seedLeaves(); });

/* ========= Contador ========= */
function startCounter(isoDate){
  const start=new Date(isoDate+"T00:00:00");
  function update(){
    const now=new Date(); let diff=Math.max(0, now-start);
    const d=Math.floor(diff/(1000*60*60*24)); diff-=d*(1000*60*60*24);
    const h=Math.floor(diff/(1000*60*60)); diff-=h*(1000*60*60);
    const m=Math.floor(diff/(1000*60)); diff-=m*(1000*60);
    const s=Math.floor(diff/1000);
    dEl.textContent=d; hEl.textContent=String(h).padStart(2,'0');
    mEl.textContent=String(m).padStart(2,'0'); sEl.textContent=String(s).padStart(2,'0');
  }
  const dEl=document.getElementById('d'), hEl=document.getElementById('h'),
        mEl=document.getElementById('m'), sEl=document.getElementById('s');
  update(); setInterval(update, 1000);
}
startCounter(FECHA_INICIO);

/* ========= Bot√≥n Te amo + M√∫sica ========= */
const btn=document.getElementById('loveBtn');
const burst=document.getElementById('burst');
const music=document.getElementById('bgMusic');
function burstHearts(){
  const N=14;
  for(let i=0;i<N;i++){
    const span=document.createElement('span');
    span.textContent=['üíó','üíñ','üíï','üíû'][Math.floor(Math.random()*4)];
    const ang=(i/N)*Math.PI*2+(Math.random()-.5)*0.6;
    const dist=60+Math.random()*80;
    const dx=Math.cos(ang)*dist, dy=Math.sin(ang)*dist-20;
    span.style.setProperty('--dx', dx+'px');
    span.style.setProperty('--dy', dy+'px');
    span.style.setProperty('--rot', (Math.random()*720-360)+'deg');
    span.style.fontSize=(16+Math.random()*12)+'px';
    span.style.animationDuration=(700+Math.random()*400)+'ms';
    burst.appendChild(span); setTimeout(()=> span.remove(), 1200);
  }
}
btn.addEventListener('click', async ()=>{
  burstHearts();
  if(navigator.vibrate) navigator.vibrate([25,50,25]);
  try{ music.paused ? await music.play() : music.pause(); }catch{}
});

/* ========= Registro PWA + bot√≥n Instalar ========= */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js', { scope: './' }).catch(console.error);
  });
}

let deferredPrompt;
const installBtn = document.getElementById('pwaInstall');

window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  installBtn.classList.add('show');
});

installBtn.addEventListener('click', async ()=>{
  if(!deferredPrompt) return;
  installBtn.classList.remove('show');
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});

window.addEventListener('appinstalled', ()=> installBtn.classList.remove('show'));
</script>
</body>
</html>
