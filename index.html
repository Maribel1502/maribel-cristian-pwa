<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>Maribel y Cristian ‚Äî √Årbol de Corazones (PWA)</title>

<!-- PWA: Manifest + theme -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#ffd7e8">

<!-- iOS (opcional) -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
  :root{
    --card-bg:#fff6f9;
    --card-radius:28px;
    --accent:#ff6f91;
    --ink:#3a2b2e;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
    color:var(--ink);
    background:
      radial-gradient(1200px 600px at 20% -10%, rgba(255,180,200,.35), transparent 60%),
      radial-gradient(1000px 700px at 120% 10%, rgba(255,210,230,.45), transparent 60%),
      linear-gradient(180deg, #fff0f5 0%, #ffe3ee 40%, #ffd7e8 100%);
    overflow-x:hidden;
  }

  .bg-hearts{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0; }
  .bg-heart{
    position:absolute; color:#ffb3c1; opacity:.18; font-size:clamp(16px, 4vw, 36px);
    animation: floatBg linear infinite; filter: blur(.2px);
  }
  @keyframes floatBg{
    from{ transform:translateY(110vh) rotate(0deg) }
    to  { transform:translateY(-20vh) rotate(360deg) }
  }

  .wrap{ position:relative; z-index:1; max-width:860px; margin:26px auto; padding:16px; }
  .card{
    background:var(--card-bg);
    border-radius:var(--card-radius);
    box-shadow:0 12px 40px rgba(0,0,0,.12);
    padding:24px 16px 28px;
    border:1px solid #ffe2ec;
  }

  .title{ text-align:center; font-weight:800; letter-spacing:.3px; margin:6px 8px 4px; font-size:clamp(20px, 4.6vw, 28px); color:#a14d66; }
  .subtitle{ text-align:center; margin:0 0 16px; color:#b36a80; font-weight:600; }

  .canvas-wrap{ position:relative; width:100%; aspect-ratio: 16/10; border-radius:18px; overflow:hidden; background: #ffe9f0; border:1px solid #ffd6e3; }

  .lead{margin:14px 10px 4px; color:#7d5a63}
  .timer{ margin:0 10px 10px; font-size:clamp(18px, 4.5vw, 26px); font-weight:800; color:#5b434a; letter-spacing:.2px; }
  .ground{ height:2px; background:#9a6f6f; opacity:.35; margin:10px 6px 0; border-radius:2px; }

  .cta{ display:flex; justify-content:center; margin-top:18px; }
  .love-btn{
    position:relative; display:inline-flex; align-items:center; gap:.6rem;
    padding:.95rem 1.25rem; border-radius:999px; border:none; cursor:pointer;
    font-weight:900; letter-spacing:.4px; color:white;
    background: radial-gradient(120% 180% at 30% 20%, #ff9ab2, #ff6f91 50%, #ff477e 100%);
    box-shadow: 0 10px 22px rgba(255,111,145,.35), inset 0 0 18px rgba(255,255,255,.18);
    transform:translateZ(0); animation:pulse 2.2s ease-in-out infinite; user-select:none;
  }
  .love-btn:active{ transform:scale(.98) }
  .love-btn .heart-ico{ filter: drop-shadow(0 2px 2px rgba(0,0,0,.15)); }
  @keyframes pulse{
    0%,100%{ box-shadow:0 10px 22px rgba(255,111,145,.35), 0 0 0 0 rgba(255,111,145,.35) }
    50%{ box-shadow:0 10px 22px rgba(255,111,145,.35), 0 0 0 16px rgba(255,111,145,0) }
  }
  .burst{ position:absolute; inset:0; pointer-events:none; overflow:visible; }
  .burst span{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    font-size:14px; color:#ff8fab; will-change:transform,opacity; animation:pop 900ms ease-out forwards;
    text-shadow:0 1px 0 rgba(255,255,255,.6);
  }
  @keyframes pop{
    0%{ opacity:1; transform:translate(-50%,-50%) scale(.4) }
    80%{ opacity:1 }
    100%{ opacity:0; transform:translate(var(--dx), var(--dy)) rotate(var(--rot)) scale(0.9) }
  }

  /* Bot√≥n ‚ÄúInstalar app‚Äù flotante */
  .install-btn{
    position: fixed; right: 14px; bottom: 14px; z-index: 10;
    padding:.7rem 1rem; border-radius:999px; border:none; cursor:pointer;
    background:#ffffffdd; color:#a14d66; font-weight:800; box-shadow:0 6px 18px rgba(0,0,0,.15);
    display:none;
  }
  .install-btn.show{ display:inline-block; }

  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
</style>
</head>
<body>

<!-- Fondo: corazones flotando -->
<div class="bg-hearts" aria-hidden="true" id="bg"></div>

<div class="wrap">
  <div class="card" role="group" aria-label="Tarjeta de San Valent√≠n">
    <h2 class="title">Maribel ‚ù§Ô∏è Cristian</h2>
    <p class="subtitle">Para el amor de mi vida:</p>
    <p class="subtitle">Si pudiera elegir un lugar seguro, seria a tu lado. </p>
    <p class="subtitle">Cu√°nto m√°s tiempo estoy contigo m√°s te amo. </p>

    <!-- Lienzo del √°rbol animado -->
    <div class="canvas-wrap">
      <canvas id="heartTreeCanvas"></canvas>
    </div>

    <p class="lead">Mi amor por ti comenz√≥ hace‚Ä¶</p>
    <p class="timer"><span id="d"></span> d√≠as <span id="h"></span> horas <span id="m"></span> minutos <span id="s"></span> segundos</p>

    <div class="ground" aria-hidden="true"></div>

    <!-- Bot√≥n Te amo + estallido -->
    <div class="cta">
      <button class="love-btn" id="loveBtn" aria-live="polite" aria-label="Te amo">
        <span class="heart-ico" aria-hidden="true">üíó</span>
        Te amo
        <span class="heart-ico" aria-hidden="true">üíó</span>
        <span class="burst" aria-hidden="true" id="burst"></span>
      </button>
    </div>

    <!-- Audio: coloca tu archivo local con este nombre -->
    <audio id="bgMusic" preload="auto">
      <source src="Married-Life-Up.mp3" type="audio/mpeg">
      Tu navegador no soporta audio HTML5.
    </audio>
  </div>
</div>

<!-- Bot√≥n flotante para instalar PWA -->
<button id="pwaInstall" class="install-btn" aria-label="Instalar app">‚ûï Instalar app</button>

<script>
/* ============================================
      √ÅRBOL MUY DEFINIDO EN FORMA DE CORAZ√ìN
   ============================================ */

const canvas = document.getElementById("treeCanvas");
const ctx = canvas.getContext("2d", { alpha: true });

let W, H, DPR;

function fit() {
    DPR = Math.min(window.devicePixelRatio || 1, 2);
    const r = canvas.getBoundingClientRect();
    W = r.width;
    H = r.height;
    canvas.width = W * DPR;
    canvas.height = H * DPR;
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
}
fit();
addEventListener("resize", fit);

// Paleta rojo/rosa
const PALETTE = [
    "#ff1744", "#ff335f", "#e53935", "#ff4d4d",
    "#ff6f91", "#ff8a80", "#f06292", "#ff99a5",
    "#ffadc2", "#ff7a90"
];

/*  
    NUEVA FUNCI√ìN: coraz√≥n mucho m√°s definido.
    Esta versi√≥n es EXACTA a la curva cl√°sica
    y genera una silueta muy n√≠tida.
*/
function inHeart(x, y) {
    // Ajustamos la ecuaci√≥n para hacerlo m√°s ‚Äúaplanado‚Äù arriba
    const xx = x * 1.15;
    const yy = y * 1.05;

    const a = xx * xx + yy * yy - 1;
    return (a * a * a - xx * xx * yy * yy * yy) <= 0;
}

const leaves = [];
const falling = [];

// CREA LOS PUNTOS DE LA COPA DEL CORAZ√ìN
function seed() {
    leaves.length = 0;
    falling.length = 0;

    const cx = W * 0.64; // posici√≥n a la derecha
    const cy = H * 0.45;
    const sx = W * 0.19;
    const sy = H * 0.23;

    const COUNT = 900;  // MUCH√çSIMO M√ÅS AGRUPADO
    for (let i = 0; i < COUNT; i++) {
        let nx, ny, tries = 0;
        do {
            nx = (Math.random() * 2.4 - 1.2);
            ny = (Math.random() * 2.4 - 1.2);
            tries++;
            if (tries > 30) break;
        } while (!inHeart(nx, ny));

        // Bordes m√°s densos (como en la imagen)
        if (Math.random() < 0.35) {
            const edgeBoost = (Math.random() * 0.08) + 0.92;
            nx *= edgeBoost;
            ny *= edgeBoost;
        }

        const x = cx + nx * sx + (Math.random() - 0.5) * 4;
        const y = cy + ny * sy + (Math.random() - 0.5) * 4;

        leaves.push({
            baseX: x, baseY: y,
            x, y,
            size: 8 + Math.random() * 12,
            rot: Math.random() * Math.PI,
            color: PALETTE[(Math.random() * PALETTE.length) | 0],
            swayA: 4 + Math.random() * 6,
            swayW: 0.6 + Math.random() * 1.0,
            t0: Math.random() * 1000
        });
    }
}
seed();

// Coraz√≥n dibujado
function drawHeart(x, y, s, rot, col) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rot);
    ctx.scale(s * 0.1, s * 0.1);

    ctx.beginPath();
    ctx.moveTo(0, -10);
    ctx.bezierCurveTo(12, -24, 34, -14, 0, 12);
    ctx.bezierCurveTo(-34, -14, -12, -24, 0, -10);
    ctx.closePath();

    ctx.fillStyle = col;
    ctx.shadowColor = "rgba(0,0,0,.12)";
    ctx.shadowBlur = 2;
    ctx.fill();
    ctx.restore();
}

// tronco
function drawTrunk() {
    const bx = W * 0.63, top = H * 0.56, bottom = H * 0.90;
    ctx.fillStyle = "#8f5f30";
    ctx.beginPath();
    ctx.moveTo(bx - 14, top);
    ctx.lineTo(bx + 14, top);
    ctx.lineTo(bx + 22, bottom);
    ctx.lineTo(bx - 22, bottom);
    ctx.closePath();
    ctx.fill();
}

const FALL_PROB = 0.0011;
const WIND = 0.34;

let t0 = performance.now();
function render(t) {
    const tt = (t - t0) / 1000;

    ctx.clearRect(0, 0, W, H);

    const g = ctx.createLinearGradient(0, 0, 0, H);
    g.addColorStop(0, "#faefe7");
    g.addColorStop(1, "#f1e3d7");
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, W, H);

    drawTrunk();

    // Hojas fijas
    for (const leaf of leaves) {
        const wind = Math.sin((tt + leaf.t0) * leaf.swayW) * leaf.swayA * WIND;
        const x = leaf.baseX + wind;
        const y = leaf.baseY + Math.sin((tt + leaf.t0) * leaf.swayW * 0.9) * 1.4;
        const r = leaf.rot + Math.sin((tt + leaf.t0) * leaf.swayW) * 0.14;

        drawHeart(x, y, leaf.size, r, leaf.color);

        if (Math.random() < FALL_PROB && x < W * 0.70) {
            falling.push({
                x, y,
                vx: -(0.35 + Math.random() * 0.5),
                vy: (0.25 + Math.random() * 0.4),
                rot: r,
                vr: (Math.random() - 0.5) * 0.04,
                size: leaf.size,
                color: leaf.color
            });
        }
    }

    // Hojas cayendo
    for (let i = falling.length - 1; i >= 0; i--) {
        const f = falling[i];
        f.vx += -0.002;
        f.vy += 0.018;
        f.x += f.vx * 1.4;
        f.y += f.vy * 1.4;
        f.rot += f.vr;

        drawHeart(f.x, f.y, f.size, f.rot, f.color);
        if (f.y > H + 40 || f.x < -40) falling.splice(i, 1);
    }

    requestAnimationFrame(render);
}
requestAnimationFrame(render);
</script>
</body>
</html>
